<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Notifikasi PWA</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Demo Notifikasi PWA</h1>
    <button id="requestPermissionBtn">Minta Izin Notifikasi</button>
    <button id="sendNotificationBtn" disabled>Kirim Notifikasi dari Service Worker</button>
    <p id="status">Status Notifikasi: Belum ada permintaan.</p>

    <script>
        const requestPermissionBtn = document.getElementById('requestPermissionBtn');
        const sendNotificationBtn = document.getElementById('sendNotificationBtn');
        const statusElement = document.getElementById('status');

        function updateStatus(message, type = '') {
            statusElement.textContent = `Status Notifikasi: ${message}`;
            statusElement.className = type;
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
                updateStatus('Service Worker berhasil didaftarkan.', 'success');
                console.log('Service Worker terdaftar:', registration);
                checkNotificationPermission(); // Cek izin setelah SW terdaftar
            })
            .catch(error => {
                updateStatus(`Gagal mendaftarkan Service Worker: ${error.message}`, 'error');
                console.error('Pendaftaran Service Worker gagal:', error);
            });
        } else {
            updateStatus('Browser Anda tidak mendukung Service Worker.', 'error');
            requestPermissionBtn.disabled = true;
            sendNotificationBtn.disabled = true;
        }

        // Minta Izin Notifikasi
        requestPermissionBtn.addEventListener('click', () => {
            if (!('Notification' in window)) {
                updateStatus('Browser tidak mendukung notifikasi.', 'error');
                return;
            }
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    updateStatus('Izin notifikasi diberikan!', 'success');
                    sendNotificationBtn.disabled = false;
                    requestPermissionBtn.disabled = true;
                } else if (permission === 'denied') {
                    updateStatus('Izin notifikasi ditolak.', 'error');
                    sendNotificationBtn.disabled = true;
                    requestPermissionBtn.disabled = true;
                } else {
                    updateStatus('Permintaan izin notifikasi ditutup.');
                    sendNotificationBtn.disabled = true;
                }
            }).catch(error => {
                updateStatus(`Kesalahan saat meminta izin: ${error}`, 'error');
            });
        });

        // Fungsi untuk mengirim pesan ke Service Worker agar menampilkan notifikasi
        sendNotificationBtn.addEventListener('click', async () => {
            if ('serviceWorker' in navigator && Notification.permission === 'granted') {
                const registration = await navigator.serviceWorker.ready;
                registration.active.postMessage({
                    type: 'SHOW_NOTIFICATION',
                    title: 'Notifikasi dari Service Worker',
                    body: 'Ini adalah notifikasi yang dikirim melalui Service Worker!',
                    icon: 'https://via.placeholder.com/128' // Ganti dengan ikon Anda
                });
                updateStatus('Permintaan notifikasi dikirim ke Service Worker.');
            } else {
                updateStatus('Tidak dapat mengirim notifikasi. Pastikan Service Worker terdaftar dan izin diberikan.', 'error');
            }
        });

        // Fungsi untuk memeriksa status izin notifikasi saat dimuat
        function checkNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    updateStatus('Izin notifikasi sudah diberikan.', 'success');
                    requestPermissionBtn.disabled = true;
                    sendNotificationBtn.disabled = false;
                } else if (Notification.permission === 'denied') {
                    updateStatus('Izin notifikasi ditolak.', 'error');
                    requestPermissionBtn.disabled = true;
                    sendNotificationBtn.disabled = true;
                } else { // 'default'
                    updateStatus('Izin notifikasi belum diminta.');
                    requestPermissionBtn.disabled = false;
                    sendNotificationBtn.disabled = true;
                }
            }
        }
    </script>
</body>
</html>
